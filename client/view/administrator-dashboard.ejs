<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Melvrick Goh">
    <link rel="icon" href="../img/favicon.png">

    <title>Service Dashboard</title>

    <!-- Bootstrap core CSS -->
    <!--link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet"-->
    <link href="../stylesheets/simple-sidebar.css" rel="stylesheet">
    <link href="../stylesheets/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../stylesheets/dataTables.bootstrap.css">
    <!-- This is a very simple parallax effect achieved by simple CSS 3 multiple backgrounds, made by http://twitter.com/msurguy -->


  </head>

  <body>
    <nav class="navbar navbar-default" style="z-index:1001" role="navigation">
     <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" 
           data-target="#example-navbar-collapse">
           <span class="sr-only">Toggle navigation</span>
           <span class="icon-bar"></span>
           <span class="icon-bar"></span>
           <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/lessons">Administration</a>
     </div>
     <div class="collapse navbar-collapse" id="example-navbar-collapse">
        <ul class="nav navbar-nav">
           <li><a href="/mydrive">My Drive</a></li>
           <li class="active"><a href="/lessons">Lessons</a></li>
        </ul>
     </div>
    </nav>

    <div id="wrapper">

      <!-- Sidebar -->
      <div id="sidebar-wrapper" style="margin-top:-60px">
          <ul class="sidebar-nav" style="margin-top:60px">
              <li class="sidebar-brand">
                Big header
              </li>
              <li><a href="#">Small header</a></li>
          </ul>
      </div>
      <!-- /#sidebar-wrapper -->

      <!-- Page Content -->
      <div id="page-content-wrapper">
          <div class="container-fluid">
              <!-- SAMPLE TABLE-->
              <div class="container" style="margin-top: 10px">
                      
                <table cellspacing="0" width="75%" class="table table-striped table-bordered" id="example">
                  <thead>
                    <tr>
                      <th>File</th>
                      <th></th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    <%for(var i = 0; i<files.length; i++){
                      var file = files[i];%>
                        <tr id="row-<%=file.id%>">
                          <td><%=file.title%></td>
                          <td>
                            <button class="btn btn-primary" data-title="View data" data-toggle="modal" data-target="#<%=file.id%>">
                              View Data
                            </button>
                          </td>
                          <td>
                            <button class="btn btn-warning" data-title="Remove Access" data-toggle="modal" data-target="#<%=file.id%>-permission">
                              Remove Access
                            </button>
                          </td>
                        </tr>
                    <%}%>                   
                  </tbody>
                </table>
                      
              </div>
              <!-- SAMPLE TABLE -->

              <%for(var i = 0; i<files.length; i++){
                var file = files[i];
                %>
                <div class="modal fade" id="<%=file.id%>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="myModalLabel"><%=file.title%></h4>
                      </div>
                      <div class="modal-body">
                        <p><strong>ID: </strong><%=file.id%></p>
                        <p><strong>Title: </strong><%=file.title%></p>
                        <p><strong>Owners: </strong><%=file.owners[0].displayName%></p>
                        <%if(file.sharingUser){%>
                          <p><strong>Sharing User: </strong><%=file.sharingUser.displayName%></p>
                        <%}%>
                        <div class="img-poster clearfix">
                          <p><strong>Last Modified: </strong></p>
                          <%if(file.lastModifyingUser.picture){%>
                            <a href=""><img class="img-circle" src="<%=file.lastModifyingUser.picture.url%>"/></a>
                          <%}%>
                          <strong><a href=""><%=file.lastModifyingUser.displayName%></a></strong>
                          <span><%=file.modifiedDate%></span>
                        </div>
                        <p><a href="<%=file.alternateLink%>" target="_blank">Google Link</a></p>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <!--button type="button" class="btn btn-primary">Save changes</button-->
                      </div>
                    </div>
                  </div>
                </div>

                <!--div class="modal fade" id="<%=file.id%>-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="myModalLabel">Delete File</h4>
                      </div>
                      <div class="modal-body">
                        <p>Are you sure you wish to delete '<%=file.title%>'?</p>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-danger" onClick="serviceDelete('<%=file.id%>')">Delete</button>
                      </div>
                    </div>
                  </div>
                </div-->

                <div class="modal fade" id="<%=file.id%>-permission" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="myModalLabel">Remove File Access</h4>
                      </div>
                      <div class="modal-body">
                        <p>Remove this file '<%=file.title%>' from your list?</p>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-warning" onClick="servicePermission('<%=file.id%>')">Remove Access</button>
                      </div>
                    </div>
                  </div>
                </div>
              <%}%>
          </div>
      </div>
      <!-- /#page-content-wrapper -->

  </div>

    <!-- Bootstrap core JavaScript <script src="../../assets/js/docs.min.js"></script>
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript" language="javascript" src="../js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" charset="utf-8" language="javascript" src="../js/dataTables.bootstrap.js"></script>
    <script src="../bootstrap/js/bootstrap.min.js"></script>
    <script>
      var GLOBALTABLE;
      $(document).ready(function() {
        GLOBALTABLE = $('#example').dataTable();
        console.log(GLOBALTABLE);
      });

      var serviceDelete =function(id){
          var xhr = new XMLHttpRequest();
          xhr.open('GET', '/service/ws/files?delete='+id, true);
          xhr.onreadystatechange = function() {
              if(xhr.readyState == 4 && xhr.status==200){
                var jsonResponse = JSON.parse(xhr.responseText);
                alert(xhr.responseText);
              }
          };

          xhr.send();
        }

        var servicePermission =function(id){
          var xhr = new XMLHttpRequest();
          xhr.open('GET', '/service/ws/files?permission='+id, true);
          xhr.onreadystatechange = function() {
              if(xhr.readyState == 4 && xhr.status==200){
                var jsonResponse = JSON.parse(xhr.responseText);
                var row = $('#row-'+id);
                //var table = $('#example').DataTable();
                var table = $('#example').DataTable();
                table.rows(row).remove().draw();
                $('#'+id+'-permission').modal('hide');
              }
          };

          xhr.send();
        }
    </script>
  </body>
</html>
